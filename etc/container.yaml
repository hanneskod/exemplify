parameters:
    DEFAULT_CONFIG_FILE: 'readme-tester.yaml.dist'
    USER_CONFIG_FILE: 'readme-tester.yaml'

services:
    _defaults:
        public: false
        autowire: true

    hanneskod\readmetester\:
        resource: '../src/*'
        exclude: '../src/{DependencyInjection/ProjectServiceContainer.php}'

    application:
        class: Symfony\Component\Console\SingleCommandApplication
        public: true
        configurator: ['@hanneskod\readmetester\Console\CliConsole', 'configure']
        calls:
            - method: 'setName'
              arguments: ['Readme-Tester']
            - method: 'setVersion'
              arguments: ['dev']
            - method: 'setCode'
              arguments: ['@hanneskod\readmetester\Console\CliConsole']

    hanneskod\readmetester\Config\ConfigManager:
        class: ~
        arguments: ['@default_config_repository']
        configurator: ['@config_loader', 'loadYamlFile']

    default_config_repository:
        class: hanneskod\readmetester\Config\RepositoryInterface
        factory: ['@hanneskod\readmetester\Config\DefaultConfigFactory', 'createRepository']

    hanneskod\readmetester\Config\DefaultConfigFactory:
        class: ~
        arguments: ['%DEFAULT_CONFIG_FILE%']

    config_loader:
        class: hanneskod\readmetester\Config\YamlFileLoader
        arguments: ['%USER_CONFIG_FILE%']

    Psr\EventDispatcher\EventDispatcherInterface:
        class: Crell\Tukio\Dispatcher
        arguments: ['@Fig\EventDispatcher\AggregateProvider']

    Fig\EventDispatcher\AggregateProvider:
        class: ~
        calls:
            - method: addProvider
              arguments: ['@Crell\Tukio\OrderedProviderInterface']

    Crell\Tukio\OrderedProviderInterface:
        class: Crell\Tukio\OrderedListenerProvider
        calls:
            - method: addListener
              arguments: ['@hanneskod\readmetester\Event\Listener\ExitStatusListener']
